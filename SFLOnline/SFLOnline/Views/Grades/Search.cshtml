@model Tuple<IEnumerable<SFLOnline.Models.EnrollmentStudent>, IEnumerable<SFLOnline.Models.GradePercentage>, IEnumerable<SFLOnline.Models.Grade>>

@{
    ViewBag.Title = "Search";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<h2>Search By Student ID</h2>


@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

<div class="form-horizontal">
    <form method="post" action="~/Controllers/GradesController/Search">
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })

        <div class="container" style="margin-top:2%">
            <div class="row">
                <div class="col-md-2">
                    @Html.Label("StudentID", htmlAttributes: new { @class = "control-label col-md-1" })
                </div>
                <div class="col-md-3">
                    @Html.TextBox("StudentId", null, htmlAttributes: new { @class = "form-control col-md-10" })
                </div>

                <div class="col-md-3">
                    <input type="submit" value="Search" class="btn btn-success" />
                </div>
            </div>
        </div>


    </form>
    @if (Model != null)
    {
        <table class="table mt-2" >
            <tr>
                <th>
                    StudentID
                </th>

                @foreach (var item in Model.Item2)
                {
                <th>
                    <span class="text-primary">@Html.DisplayFor(modelItem => item.Track.TrackName)</span><br />
                    <span class="text-primary">@Html.DisplayFor(modelItem => item.Course.Title)</span><br />
                        @Html.DisplayFor(modelItem => item.name)<br>
                        % @Html.DisplayFor(modelItem => item.percentage)

                </th>
                }
                
            </tr>
            @{
                var count = 0;
                var studentcount = 0;
                foreach (var item in Model.Item1)
                {
                    <tr>
                        <td>
                            @Html.DisplayFor(modelItem => item.StudentId)<br />
                            <span class="text-primary">@Html.DisplayFor(modelItem => item.Class.Track.TrackName)</span>
</td>
                        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                        @foreach (var item2 in Model.Item2)
                        {
                            foreach (var item3 in Model.Item3)
                            {
                                if (item3.StudentId == item.StudentId && item3.GradePercentageId == item2.Id)
                                {
                                    <td>
                                        <div class="form-group">
                                            <div class="col-sm-2">
                                                <input type="text" id="@count" value="@item3.Grades" style="width:35px" onchange="sum()" />
                                                @{
                                                    count = count + 1;
                                                }
                                                <input type="text" id="@count" value="@item3.Id" style="width:35px; display:none" />
                                                @{
                                                    count = count + 1;
                                                }

                                            </div>
                                        </div>

                                    </td>
                                }


                            }

                        }
                    </tr>
                }
                <input type="text" id="text1" value="@count" style="width:35px; display:none" />
                <input type="text" id="studentcount" value="@studentcount" style="width:35px; display:none" />
            }
        </table>
        <div class="form-group container float-right">
            <div class="col-md-offset-2 col-md-10 border-top-0">
                <input type="button" value="Save" class="btn btn-success btn-lg float-right " style="margin-top:1%" onclick="test()" />
            </div>
        </div>

    }
</div>
}

<div class="mt-3">
    @Html.ActionLink("Back to List", "Index")
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}
<script>

    function test() {
        var x = document.getElementById("text1").value;
        var stringArray = new Array();
        var stringArray2 = new Array();
        var a = 0;
        for (var count = 0; count < x; count++) {
            stringArray2[a] = document.getElementById(count).value;
            stringArray[a] = document.getElementById(++count).value;
            a++;
        }
        var postData = { values: stringArray, values2: stringArray2 };

        $.ajax({
            type: "POST",
            url: "/Grades/GradePercentage2",
            data: postData,
            success: function (data) {
                alert(data.Result);
            },
            dataType: "json",
            traditional: true
        });
    }

</script>
